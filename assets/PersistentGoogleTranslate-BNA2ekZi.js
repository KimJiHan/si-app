var e=(e,t,r)=>new Promise((n,a)=>{var o=e=>{try{l(r.next(e))}catch(t){a(t)}},s=e=>{try{l(r.throw(e))}catch(t){a(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(o,s);l((r=r.apply(e,t)).next())});import{r as t,j as r}from"./index-NFq4SSy3.js";import"./react-vendor-HnKmhvXM.js";function n({currentView:n="gallery",triggerTranslation:a=0}){const[o,s]=t.useState("ko"),[l,c]=t.useState(!1),[i,d]=t.useState(!1),u=t.useRef(new Map),h=t.useRef(new Map),g=t.useRef(!1),f=t.useRef(!1),m=t.useRef(n),x="AIzaSyArrhA6dhancWZXkUof6xe8K9sirudQWT8",p=[{code:"ko",name:"ÌïúÍµ≠Ïñ¥",flag:"üá∞üá∑"},{code:"en",name:"English",flag:"üá∫üá∏"}],y="si-app-language",w=()=>{const e=localStorage.getItem(y);if(e&&["ko","en"].includes(e))return e;const t=new URLSearchParams(window.location.search).get("lang");return t&&["en"].includes(t)?t:"ko"},T=t.useCallback(()=>{const e=[],t=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;if(!t)return NodeFilter.FILTER_REJECT;if(["SCRIPT","STYLE","NOSCRIPT","META","CODE"].includes(t.tagName))return NodeFilter.FILTER_REJECT;if(t.classList.contains("notranslate")||t.hasAttribute("data-no-translate"))return NodeFilter.FILTER_REJECT;if(t.closest(".notranslate")||t.closest("[data-no-translate]"))return NodeFilter.FILTER_REJECT;if(t.closest('[aria-label="Ïñ∏Ïñ¥ ÏÑ†ÌÉù"]'))return NodeFilter.FILTER_REJECT;const r=e.textContent.trim();return r&&0!==r.length?/^\d+$/.test(r)&&r.length<4?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let r;for(;r=t.nextNode();)e.push(r);return e},[]),E=t.useCallback((t,r)=>e(null,null,function*(){if(0===t.length)return t;const e=r;try{const n=e=>`${e}_${r}`,a=[],o=new Map;if(t.forEach((e,t)=>{const r=n(e);u.current.has(r)?o.set(t,u.current.get(r)):a.push({text:e,index:t})}),a.length>0){const t=yield fetch(`https://translation.googleapis.com/language/translate/v2?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:a.map(e=>e.text),source:"ko",target:e,format:"text"})});if(t.ok){const e=(yield t.json()).data.translations;a.forEach((t,r)=>{const a=e[r].translatedText,s=n(t.text);u.current.set(s,a),o.set(t.index,a)})}else{yield t.text()}}return t.map((e,r)=>o.get(r)||t[r])}catch(n){return t}}),[x]),b=t.useCallback(t=>e(null,null,function*(){const e=document.querySelectorAll("h2, h3");for(const n of e)if(n.innerHTML&&!n.classList.contains("notranslate")){h.current.has(n)||h.current.set(n,n.innerHTML);const e=(h.current.get(n)||n.innerHTML).split(/<br\s*\/?>/gi).map(e=>e.replace(/<[^>]*>/g,"").trim()).filter(e=>e.length>0);if(e.length>0&&"ko"!==t){const r=yield E(e,t);if(r&&r.length>0){const e=r.join("<br/>");n.innerHTML=e}}}const r=document.querySelectorAll("[placeholder], [title], [alt]");for(const n of r)if(!n.classList.contains("notranslate")){const e=["placeholder","title","alt"];for(const r of e){const e=n.getAttribute(r);if(e&&e.trim()){const a=`${n}_${r}`;if(h.current.has(a)||h.current.set(a,e),"ko"!==t){const o=h.current.get(a)||e,s=yield E([o],t);s[0]&&n.setAttribute(r,s[0])}}}}}),[E]),k=t.useCallback(t=>e(null,null,function*(){if("ko"===t)return h.current.forEach((e,t)=>{t&&t.parentNode&&(t.nodeType===Node.TEXT_NODE?t.textContent=e:void 0!==t.innerHTML&&(t.innerHTML=e))}),g.current=!1,f.current=!1,void d(!1);if(!f.current){f.current=!0,d(!0);try{yield b(t);const e=T();e.forEach(e=>{h.current.has(e)||h.current.set(e,e.textContent)});const r=20;for(let n=0;n<e.length;n+=r){const a=e.slice(n,n+r),o=a.map(e=>h.current.get(e)||e.textContent),s=yield E(o,t);yield new Promise(e=>{requestAnimationFrame(()=>{a.forEach((e,t)=>{e&&e.parentNode&&s[t]&&(e.textContent=s[t])}),e()})}),n+r<e.length&&(yield new Promise(e=>setTimeout(e,100)))}g.current=!0}catch(e){}finally{f.current=!1,d(!1)}}}),[T,E,b]),R=t.useCallback(e=>{if(e===o)return void c(!1);(e=>{localStorage.setItem(y,e);const t=new URL(window.location.href);"ko"===e?t.searchParams.delete("lang"):t.searchParams.set("lang",e),window.history.replaceState({},"",t.toString())})(e),s(e),c(!1);const t=new URL(window.location.href);t.searchParams.delete("lang"),"ko"!==e&&t.searchParams.set("lang",e),window.location.href=t.toString()},[o]);t.useEffect(()=>{const e=w();s(e);const t=new URLSearchParams(window.location.search).has("lang");if("ko"!==e&&t){const t=setTimeout(()=>{k(e)},2e3);return()=>clearTimeout(t)}},[]),t.useEffect(()=>{if(m.current===n)return;m.current=n;const e=w(),t=new URLSearchParams(window.location.search).has("lang");if("ko"!==e&&t){g.current=!1,h.current.clear();const t=setTimeout(()=>{g.current||f.current||k(e)},"editor"===n?2500:1500);return()=>clearTimeout(t)}},[n,k]),t.useEffect(()=>{if(a>0){const e=w(),t=new URLSearchParams(window.location.search).has("lang");if("ko"!==e&&t){const t=setTimeout(()=>{f.current||k(e)},500);return()=>clearTimeout(t)}}},[a,k]);const N=p.find(e=>e.code===o);return r.jsx(r.Fragment,{children:r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>c(!l),className:"flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-200 dark:border-gray-700",disabled:i,"aria-label":"Ïñ∏Ïñ¥ ÏÑ†ÌÉù",children:[i?r.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-500 border-t-transparent rounded-full"}):r.jsx("span",{className:"text-xl",role:"img","aria-label":null==N?void 0:N.name,children:null==N?void 0:N.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:i?"Î≤àÏó≠Ï§ë...":null==N?void 0:N.name}),r.jsx("svg",{className:"w-4 h-4 text-gray-500 transition-transform "+(l?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",children:p.map(e=>r.jsxs("button",{onClick:()=>R(e.code),disabled:i,className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${o===e.code?"bg-gray-50 dark:bg-gray-700/50":""} ${i?"opacity-50 cursor-not-allowed":""}`,children:[r.jsx("span",{className:"text-xl",children:e.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:e.name}),o===e.code&&r.jsx("svg",{className:"w-4 h-4 text-blue-500 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.code))})]})})}export{n as default};
