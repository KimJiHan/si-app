var e=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{s(r.next(e))}catch(t){n(t)}},l=e=>{try{s(r.throw(e))}catch(t){n(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);s((r=r.apply(e,t)).next())});import{r as t,j as r}from"./index-BF5Hkdiz.js";import"./react-vendor-HnKmhvXM.js";function a({currentView:a="gallery"}){const[n,o]=t.useState("ko"),[l,s]=t.useState(!1),[c,i]=t.useState(!1),d=t.useRef(new Map),u=t.useRef(new Map),h=t.useRef(null),m="AIzaSyArrhA6dhancWZXkUof6xe8K9sirudQWT8",g=t.useMemo(()=>[{code:"ko",name:"한국어",flag:"🇰🇷"},{code:"en",name:"English",flag:"🇺🇸"},{code:"zh",name:"中文",flag:"🇨🇳"},{code:"ja",name:"日本語",flag:"🇯🇵"}],[]),f=t.useCallback(e=>{const t=[],r=new Set(["SCRIPT","STYLE","NOSCRIPT","META"]),a=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;if(!t||r.has(t.tagName))return NodeFilter.FILTER_REJECT;const a=e.textContent.trim();return!a||a.length<2||/^[\d\s\W]+$/.test(a)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let n;for(;n=a.nextNode();)t.push(n);return t},[]),x=t.useCallback((t,r,a)=>e(null,null,function*(){if(0===t.length)return[];const e=e=>`${e}_${r}`,n=[],o=new Map;if(t.forEach((t,r)=>{const a=e(t);d.current.has(a)?o.set(r,d.current.get(a)):n.push({text:t,originalIndex:r})}),n.length>0)try{const t=yield fetch(`https://translation.googleapis.com/language/translate/v2?key=${m}`,{method:"POST",headers:{"Content-Type":"application/json"},signal:a,body:JSON.stringify({q:n.map(e=>e.text),source:"ko",target:r,format:"text"})});if(!t.ok){yield t.json().catch(()=>({}));throw new Error(`Translation API failed: ${t.status}`)}const l=(yield t.json()).data.translations;n.forEach((t,r)=>{const a=l[r].translatedText,n=e(t.text);d.current.set(n,a),o.set(t.originalIndex,a)})}catch(l){return l.name,t}return t.map((e,r)=>o.get(r)||t[r])}),[m]),p=t.useCallback(t=>e(null,null,function*(){if(h.current&&h.current.abort(),"ko"===t)return void b();h.current=new AbortController;const r=h.current.signal;i(!0);const a=()=>e(null,null,function*(){try{const e=f(document.body),a=[],n=[];e.forEach((e,t)=>{const r=e.textContent.trim();r&&(u.current.has(e)||u.current.set(e,r),a.push(r),n.push(t))});const o=50;for(let l=0;l<a.length&&!r.aborted;l+=o){const s=a.slice(l,l+o),c=yield x(s,t,r);requestAnimationFrame(()=>{s.forEach((t,r)=>{const a=n[l+r],o=e[a];o&&c[r]&&(o.textContent=c[r])})})}}catch(e){e.name}finally{i(!1),h.current=null}});"requestIdleCallback"in window?requestIdleCallback(a):setTimeout(a,0)}),[f,x]),b=t.useCallback(()=>{u.current.forEach((e,t)=>{t&&t.textContent!==e&&(t.textContent=e)})},[]),y=t.useCallback(e=>{if(e===n)return void s(!1);o(e),s(!1);const t=new URL(window.location.href);"ko"===e?t.searchParams.delete("lang"):t.searchParams.set("lang",e),window.history.replaceState({},"",t.toString()),p(e)},[n,p]);t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("lang");if(e&&["en","zh","ja"].includes(e)){o(e);const t=setTimeout(()=>p(e),300);return()=>clearTimeout(t)}},[]),t.useEffect(()=>{if("editor"===a&&"ko"!==n){const e=setTimeout(()=>p(n),500);return()=>clearTimeout(e)}},[a,n,p]),t.useEffect(()=>()=>{h.current&&h.current.abort()},[]);const w=t.useMemo(()=>g.find(e=>e.code===n),[g,n]);return r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>s(!l),className:"flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-200 dark:border-gray-700",disabled:c,"aria-label":"언어 선택","aria-expanded":l,children:[c?r.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-500 border-t-transparent rounded-full"}):r.jsx("span",{className:"text-xl",role:"img","aria-label":w.name,children:w.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:c?"번역중...":w.name}),r.jsx("svg",{className:"w-4 h-4 text-gray-500 transition-transform "+(l?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",role:"menu",children:g.map(e=>r.jsxs("button",{onClick:()=>y(e.code),disabled:c,className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${n===e.code?"bg-gray-50 dark:bg-gray-700/50":""} ${c?"opacity-50 cursor-not-allowed":""}`,role:"menuitem","aria-current":n===e.code,children:[r.jsx("span",{className:"text-xl",role:"img","aria-label":e.name,children:e.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:e.name}),n===e.code&&r.jsx("svg",{className:"w-4 h-4 text-blue-500 ml-auto",fill:"currentColor",viewBox:"0 0 20 20","aria-hidden":"true",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.code))}),!1]})}export{a as default};
