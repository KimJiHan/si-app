var e=(e,t,a)=>new Promise((r,n)=>{var l=e=>{try{s(a.next(e))}catch(t){n(t)}},o=e=>{try{s(a.throw(e))}catch(t){n(t)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(l,o);s((a=a.apply(e,t)).next())});import{r as t,j as a}from"./index-C8TVsEFK.js";import"./react-vendor-HnKmhvXM.js";function r({currentView:r="gallery"}){const[n,l]=t.useState("ko"),[o,s]=t.useState(!1),[i,c]=t.useState(!1),[d,u]=t.useState(0),h=t.useRef(new Map),x=t.useRef(new Map),g=t.useRef(null),m=t.useRef(null),f="AIzaSyArrhA6dhancWZXkUof6xe8K9sirudQWT8",p=[{code:"ko",name:"한국어",flag:"🇰🇷"},{code:"en",name:"English",flag:"🇺🇸"},{code:"zh",name:"中文",flag:"🇨🇳"},{code:"ja",name:"日本語",flag:"🇯🇵"}],b=t.useCallback(()=>{const e=[],t=new Set,a=["script","style","noscript","meta","code","pre",".notranslate","[data-no-translate]","svg"];["h1","h2","h3","h4","h5","h6","p","span","div","button","a","label","li","td","th","strong","em","b","i",".text-xs",".text-sm",".text-base",".text-lg",".text-xl",".text-2xl",".text-3xl",".text-4xl",".text-5xl",'[class*="text-"]'].forEach(r=>{document.querySelectorAll(r).forEach(r=>{if(a.some(e=>r.matches(e)))return;if(t.has(r))return;const n=document.createTreeWalker(r,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const a=e.textContent.trim();if(!a)return NodeFilter.FILTER_REJECT;if(a.length<1)return NodeFilter.FILTER_REJECT;const r=e.parentElement;if(!r)return NodeFilter.FILTER_REJECT;return["SCRIPT","STYLE","CODE","PRE","SVG"].includes(r.tagName)||t.has(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});let l;for(;l=n.nextNode();)t.has(l)||(e.push({node:l,text:l.textContent.trim(),type:"text"}),t.add(l))})});return document.querySelectorAll("[placeholder], [title], [alt], [aria-label]").forEach(a=>{a.placeholder&&!t.has(a.placeholder)&&e.push({node:a,text:a.placeholder,type:"placeholder",attribute:"placeholder"}),a.title&&!t.has(a.title)&&e.push({node:a,text:a.title,type:"title",attribute:"title"}),a.alt&&!t.has(a.alt)&&e.push({node:a,text:a.alt,type:"alt",attribute:"alt"}),a.getAttribute("aria-label")&&!t.has(a["aria-label"])&&e.push({node:a,text:a.getAttribute("aria-label"),type:"aria-label",attribute:"aria-label"})}),e},[]),y=t.useCallback((t,a,r)=>e(null,null,function*(){if(0===t.length)return[];const e=e=>`${e}_${a}`,n=[],l=new Map;if(t.forEach((t,a)=>{const r=e(t);h.current.has(r)?l.set(a,h.current.get(r)):n.push({text:t,originalIndex:a})}),n.length>0)try{const t=yield fetch(`https://translation.googleapis.com/language/translate/v2?key=${f}`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:r,body:JSON.stringify({q:n.map(e=>e.text),source:"ko",target:a,format:"text"})});if(!t.ok)throw new Error(`Translation API failed: ${t.status}`);const o=(yield t.json()).data.translations;n.forEach((t,a)=>{const r=o[a].translatedText,n=e(t.text);h.current.set(n,r),l.set(t.originalIndex,r)})}catch(o){return o.name,t}return t.map((e,a)=>l.get(a)||t[a])}),[f]),w=t.useCallback(t=>e(null,null,function*(){if(g.current&&g.current.abort(),"ko"===t)return k(),void u(0);g.current=new AbortController;const e=g.current.signal;c(!0),u(0);try{const a=b();if(0===a.length)return void c(!1);a.forEach(e=>{const t="text"===e.type?e.node:`${e.node}_${e.attribute}`;x.current.has(t)||x.current.set(t,e.text)});const r=25;Math.ceil(a.length/r);for(let n=0;n<a.length&&!e.aborted;n+=r){const l=a.slice(n,n+r),o=l.map(e=>e.text),s=yield y(o,t,e);requestAnimationFrame(()=>{l.forEach((e,t)=>{const a=s[t];a&&("text"===e.type?e.node&&e.node.parentNode&&(e.node.textContent=a):e.node&&e.node.setAttribute(e.attribute,a))})});const i=Math.round((n+r)/a.length*100);u(Math.min(i,100))}u(100),setTimeout(()=>u(0),1e3)}catch(a){a.name}finally{c(!1),g.current=null}}),[b,y]),k=t.useCallback(()=>{x.current.forEach((e,t)=>{if("string"==typeof t&&t.includes("_")){const[a,r]=t.split("_");a&&r&&a.setAttribute(r,e)}else t&&t.parentNode&&(t.textContent=e)})},[]);t.useEffect(()=>{if("ko"===n)return;const e=new MutationObserver(e=>{e.some(e=>e.addedNodes.length>0)&&!i&&(clearTimeout(m.current),m.current=setTimeout(()=>{w(n)},500))});return e.observe(document.body,{childList:!0,subtree:!0,characterData:!0}),()=>{e.disconnect(),m.current&&clearTimeout(m.current)}},[n,i,w]);const v=t.useCallback(e=>{if(e===n)return void s(!1);l(e),s(!1);const t=new URL(window.location.href);"ko"===e?t.searchParams.delete("lang"):t.searchParams.set("lang",e),window.history.replaceState({},"",t.toString()),w(e)},[n,w]);t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("lang");e&&["en","zh","ja"].includes(e)&&(l(e),setTimeout(()=>w(e),500))},[]),t.useEffect(()=>{if("ko"!==n){const e=setTimeout(()=>w(n),500);return()=>clearTimeout(e)}},[r,n,w]);const E=p.find(e=>e.code===n);return a.jsxs("div",{className:"relative",children:[a.jsxs("button",{onClick:()=>s(!o),className:"flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-200 dark:border-gray-700",disabled:i,"aria-label":"언어 선택",children:[i?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-500 border-t-transparent rounded-full"}),d>0&&a.jsxs("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:[d,"%"]})]}):a.jsx("span",{className:"text-xl",role:"img","aria-label":E.name,children:E.flag}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:i?"번역중...":E.name}),a.jsx("svg",{className:"w-4 h-4 text-gray-500 transition-transform "+(o?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),o&&a.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",children:p.map(e=>a.jsxs("button",{onClick:()=>v(e.code),disabled:i,className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${n===e.code?"bg-gray-50 dark:bg-gray-700/50":""} ${i?"opacity-50 cursor-not-allowed":""}`,children:[a.jsx("span",{className:"text-xl",children:e.flag}),a.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:e.name}),n===e.code&&a.jsx("svg",{className:"w-4 h-4 text-blue-500 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.code))}),i&&d>0&&a.jsxs("div",{className:"fixed bottom-4 left-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 z-50",children:[a.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:["번역 진행중... ",d,"%"]}),a.jsx("div",{className:"w-48 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:a.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${d}%`}})})]})]})}export{r as default};
