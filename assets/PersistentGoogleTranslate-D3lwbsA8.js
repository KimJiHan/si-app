var e=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{s(r.next(e))}catch(t){n(t)}},l=e=>{try{s(r.throw(e))}catch(t){n(t)}},s=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,l);s((r=r.apply(e,t)).next())});import{r as t,j as r}from"./index-AWwjfpEn.js";import"./react-vendor-HnKmhvXM.js";function a({currentView:a="gallery"}){const[n,o]=t.useState("ko"),[l,s]=t.useState(!1),[c,i]=t.useState(!1),[d,u]=t.useState(!1),g=t.useRef(new Map),h=t.useRef(new Map),x=t.useRef(!1),m=t.useRef(null),f="AIzaSyArrhA6dhancWZXkUof6xe8K9sirudQWT8",p=[{code:"ko",name:"한국어",flag:"🇰🇷"},{code:"en",name:"English",flag:"🇺🇸"},{code:"zh",name:"中文",flag:"🇨🇳"},{code:"ja",name:"日本語",flag:"🇯🇵"}],y="si-app-language",b=()=>{const e=localStorage.getItem(y);if(e&&["ko","en","zh","ja"].includes(e))return e;const t=new URLSearchParams(window.location.search).get("lang");return t&&["en","zh","ja"].includes(t)?t:"ko"},k=t.useCallback(()=>{const e=[],t=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;if(!t)return NodeFilter.FILTER_REJECT;if(["SCRIPT","STYLE","NOSCRIPT","META","SVG","CODE"].includes(t.tagName))return NodeFilter.FILTER_REJECT;if(t.closest('[aria-label="언어 선택"]'))return NodeFilter.FILTER_REJECT;const r=e.textContent.trim();return r&&0!==r.length?/^\d+$/.test(r)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let r;for(;r=t.nextNode();)e.push(r);return e},[]),w=t.useCallback((t,r)=>e(null,null,function*(){if(0===t.length)return t;try{const e=e=>`${e}_${r}`,a=[],n=new Map;if(t.forEach((t,r)=>{const o=e(t);g.current.has(o)?n.set(r,g.current.get(o)):a.push({text:t,index:r})}),a.length>0){const t=yield fetch(`https://translation.googleapis.com/language/translate/v2?key=${f}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:a.map(e=>e.text),source:"ko",target:r,format:"text"})});if(t.ok){const r=(yield t.json()).data.translations;a.forEach((t,a)=>{const o=r[a].translatedText,l=e(t.text);g.current.set(l,o),n.set(t.index,o)})}}return t.map((e,r)=>n.get(r)||t[r])}catch(e){return t}}),[f]),N=t.useCallback(t=>e(null,null,function*(){if("ko"===t)return h.current.forEach((e,t)=>{t&&t.parentNode&&(t.textContent=e)}),void(x.current=!1);if(!x.current||n!==t){i(!0);try{const e=k();0===h.current.size&&e.forEach(e=>{h.current.set(e,e.textContent)});const r=25;for(let a=0;a<e.length;a+=r){const n=e.slice(a,a+r),o=n.map(e=>h.current.get(e)||e.textContent),l=yield w(o,t);requestAnimationFrame(()=>{n.forEach((e,t)=>{e&&e.parentNode&&l[t]&&(e.textContent=l[t])})})}x.current=!0}catch(e){}finally{i(!1)}}}),[k,w,n]),j=t.useCallback(e=>{e!==n?((e=>{localStorage.setItem(y,e);const t=new URL(window.location.href);"ko"===e?t.searchParams.delete("lang"):t.searchParams.set("lang",e),window.history.replaceState({},"",t.toString())})(e),o(e),s(!1),m.current=e,u(!0)):s(!1)},[n]);t.useEffect(()=>{const e=b();if(o(e),"ko"!==e&&!x.current){const t=setTimeout(()=>{N(e)},500);return()=>clearTimeout(t)}},[]),t.useEffect(()=>{const e=b();if("ko"!==e&&a&&!x.current){const t=setTimeout(()=>{N(e)},500);return()=>clearTimeout(t)}},[a,N]);const v=p.find(e=>e.code===n);return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>s(!l),className:"flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-200 dark:border-gray-700",disabled:c,"aria-label":"언어 선택",children:[c?r.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-500 border-t-transparent rounded-full"}):r.jsx("span",{className:"text-xl",role:"img","aria-label":null==v?void 0:v.name,children:null==v?void 0:v.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:c?"번역중...":null==v?void 0:v.name}),r.jsx("svg",{className:"w-4 h-4 text-gray-500 transition-transform "+(l?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",children:p.map(e=>r.jsxs("button",{onClick:()=>j(e.code),disabled:c,className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${n===e.code?"bg-gray-50 dark:bg-gray-700/50":""} ${c?"opacity-50 cursor-not-allowed":""}`,children:[r.jsx("span",{className:"text-xl",children:e.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:e.name}),n===e.code&&r.jsx("svg",{className:"w-4 h-4 text-blue-500 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.code))})]}),d&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl max-w-sm w-full",children:[r.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"언어 변경"}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"더 나은 번역 품질을 위해 페이지를 새로고침하시겠습니까?"}),r.jsxs("div",{className:"flex gap-3",children:[r.jsx("button",{onClick:()=>{const e=new URL(window.location.href);"ko"===m.current?e.searchParams.delete("lang"):e.searchParams.set("lang",m.current),window.location.href=e.toString()},className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",children:"새로고침"}),r.jsx("button",{onClick:()=>e(null,null,function*(){u(!1),"ko"===m.current?(h.current.forEach((e,t)=>{t&&t.parentNode&&(t.textContent=e)}),x.current=!1):yield N(m.current)}),className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"그냥 번역"})]})]})})]})}export{a as default};
