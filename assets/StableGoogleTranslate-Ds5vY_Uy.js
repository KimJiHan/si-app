var e=(e,t,r)=>new Promise((a,n)=>{var o=e=>{try{l(r.next(e))}catch(t){n(t)}},s=e=>{try{l(r.throw(e))}catch(t){n(t)}},l=e=>e.done?a(e.value):Promise.resolve(e.value).then(o,s);l((r=r.apply(e,t)).next())});import{r as t,j as r}from"./index-B4S7k8_a.js";import"./react-vendor-HnKmhvXM.js";function a({currentView:a="gallery"}){const[n,o]=t.useState("ko"),[s,l]=t.useState(!1),[c,i]=t.useState(!1),d=t.useRef(new Map),u=t.useRef(new Map),g=t.useRef(!1),h="AIzaSyArrhA6dhancWZXkUof6xe8K9sirudQWT8",m=[{code:"ko",name:"한국어",flag:"🇰🇷"},{code:"en",name:"English",flag:"🇺🇸"},{code:"zh",name:"中文",flag:"🇨🇳"},{code:"ja",name:"日本語",flag:"🇯🇵"}],x=t.useCallback(()=>{const e=[],t=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;if(!t)return NodeFilter.FILTER_REJECT;if(["SCRIPT","STYLE","NOSCRIPT","META","SVG"].includes(t.tagName))return NodeFilter.FILTER_REJECT;const r=e.textContent.trim();return r&&0!==r.length?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}});let r;for(;r=t.nextNode();)e.push(r);return e},[]),f=t.useCallback((t,r)=>e(null,null,function*(){if(0===t.length)return t;try{const e=e=>`${e}_${r}`,a=[],n=new Map;if(t.forEach((t,r)=>{const o=e(t);d.current.has(o)?n.set(r,d.current.get(o)):a.push({text:t,index:r})}),a.length>0){const t=yield fetch(`https://translation.googleapis.com/language/translate/v2?key=${h}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({q:a.map(e=>e.text),source:"ko",target:r,format:"text"})});if(t.ok){const r=(yield t.json()).data.translations;a.forEach((t,a)=>{const o=r[a].translatedText,s=e(t.text);d.current.set(s,o),n.set(t.index,o)})}}return t.map((e,r)=>n.get(r)||t[r])}catch(e){return t}}),[h]),p=t.useCallback(t=>e(null,null,function*(){if("ko"===t){const e=new URL(window.location.href);return e.searchParams.delete("lang"),void(window.location.href=e.toString())}i(!0);try{const e=x();e.forEach(e=>{u.current.has(e)||u.current.set(e,e.textContent)});const r=30;for(let a=0;a<e.length;a+=r){const n=e.slice(a,a+r),o=n.map(e=>u.current.get(e)||e.textContent),s=yield f(o,t);n.forEach((e,t)=>{e&&e.parentNode&&s[t]&&(e.textContent=s[t])})}g.current=!0}catch(e){}finally{i(!1)}}),[x,f]),y=t.useCallback(e=>{if(e===n)return void l(!1);const t=new URL(window.location.href);"ko"===e?t.searchParams.delete("lang"):t.searchParams.set("lang",e),window.location.href=t.toString()},[n]);t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("lang");if(e&&["en","zh","ja"].includes(e)){if(o(e),!g.current){const t=setTimeout(()=>{p(e)},500);return()=>clearTimeout(t)}}else o("ko")},[p]),t.useEffect(()=>{if("ko"!==n&&a&&!g.current){const e=setTimeout(()=>{p(n)},500);return()=>clearTimeout(e)}},[a,n,p]);const b=m.find(e=>e.code===n);return r.jsxs("div",{className:"relative",children:[r.jsxs("button",{onClick:()=>l(!s),className:"flex items-center gap-2 px-4 py-2.5 bg-white dark:bg-gray-800 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 border border-gray-200 dark:border-gray-700",disabled:c,"aria-label":"언어 선택",children:[c?r.jsx("div",{className:"animate-spin h-5 w-5 border-2 border-gray-500 border-t-transparent rounded-full"}):r.jsx("span",{className:"text-xl",role:"img","aria-label":b.name,children:b.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:c?"번역중...":b.name}),r.jsx("svg",{className:"w-4 h-4 text-gray-500 transition-transform "+(s?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),s&&r.jsx("div",{className:"absolute top-full right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",children:m.map(e=>r.jsxs("button",{onClick:()=>y(e.code),disabled:c,className:`w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors ${n===e.code?"bg-gray-50 dark:bg-gray-700/50":""} ${c?"opacity-50 cursor-not-allowed":""}`,children:[r.jsx("span",{className:"text-xl",children:e.flag}),r.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:e.name}),n===e.code&&r.jsx("svg",{className:"w-4 h-4 text-blue-500 ml-auto",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.code))}),c&&r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:r.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full"}),r.jsxs("div",{children:[r.jsx("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"언어를 변경하는 중입니다..."}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"잠시만 기다려주세요"})]})]})})})]})}export{a as default};
